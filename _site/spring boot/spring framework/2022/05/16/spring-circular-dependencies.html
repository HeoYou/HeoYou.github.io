<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>[Spring] Circular dependencies(순환참조) - HeoYou You don't know this?</title> <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"> <link rel="stylesheet" href="/assets/dist/css/style.css"> <!-- <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_big-stone.min.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_white.min.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-base16.dark.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-github.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> --> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>[Spring] Circular dependencies(순환참조) | HeoYou You don’t know this?</title> <meta name="generator" content="Jekyll v3.9.1" /> <meta property="og:title" content="[Spring] Circular dependencies(순환참조)" /> <meta name="author" content="HeoYou" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Intro" /> <meta property="og:description" content="Intro" /> <link rel="canonical" href="http://localhost:4000/spring%20boot/spring%20framework/2022/05/16/spring-circular-dependencies.html" /> <meta property="og:url" content="http://localhost:4000/spring%20boot/spring%20framework/2022/05/16/spring-circular-dependencies.html" /> <meta property="og:site_name" content="HeoYou You don’t know this?" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2022-05-16T00:00:00+09:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="[Spring] Circular dependencies(순환참조)" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"HeoYou"},"dateModified":"2022-05-16T00:00:00+09:00","datePublished":"2022-05-16T00:00:00+09:00","description":"Intro","headline":"[Spring] Circular dependencies(순환참조)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/spring%20boot/spring%20framework/2022/05/16/spring-circular-dependencies.html"},"url":"http://localhost:4000/spring%20boot/spring%20framework/2022/05/16/spring-circular-dependencies.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="content"> <header> <div class="main"> <a href="http://localhost:4000/">HeoYou You don't know this?</a> </div> <nav> <a class='' href="/">Home</a> <a class='' href="/archives.html"> Archives</a> <a class='' href="/about.html">About</a> </nav> </header> <hr class="light-hr"> <main> <div class="title"> <h1 class="title">[Spring] Circular dependencies(순환참조)</h1> <div class="meta"> <time datetime="2022-05-16">2022 05 16</time> </div> </div> <hr class="no-margin light-hr "> <h2 id="intro">Intro</h2> <p>친구가 스프링 시큐리티를 적용하면서 “The dependencies of some of the beans in the application context form a cycle” 오류가 발생했다고 나에게 물어봤다. <img src="https://user-images.githubusercontent.com/51642448/168603912-d1ea45ce-05ad-44cb-9c0b-f8c253b5c45e.png" alt="image" /></p> <p>그래서 검색을 해보았다.</p> <h2 id="순환참조">순환참조??</h2> <p>순환참조란 A클래스가 B클래스의 Bean을 주입받고, B클래스가 A클래스의 Bean을 주입받는 상황이다. 서로 참조를 하면서 순환참조가 발생한다.</p> <h2 id="왜">왜??</h2> <p>IoC컨테이너에 있는 Bean을 주입받기 위해서 세 가지 방법을 사용할 수 있다.</p> <ol> <li>필드 주입방식</li> <li>Setter 주입방식</li> <li>생성자 주입방식</li> </ol> <h3 id="필드-setter-주입방식">필드, Setter 주입방식</h3> <p>필드 주입방식과 Setter주입방식에서는 애플리케이션 실행과정에서 예외가 발생하지 않는다. 그리고 실제 두개의 클래스가 순환참조하고 있다고 하더라도 당장에 문제가 발생하지 않는다. 문제점은 해당 메소드가 호출되었을 때이다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceA</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ServiceB</span> <span class="n">serviceB</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    	<span class="n">serviceB</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceB</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ServiceA</span> <span class="n">serviceA</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    	<span class="n">serviceA</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h4 id="필드-setter-주입방식-정리">필드, Setter 주입방식 정리</h4> <ol> <li>스프링 애플리케이션 로딩 시 예외가 발생하지 않는다.</li> <li>단순 클래스가 순호나참조하는 것이 아니라 메소드가 순환호출 되어야하고, 해당 메소드가 호출되는 시점에 예외가 발생한다.</li> </ol> <h3 id="생성자-주입방식">생성자 주입방식</h3> <p>스프링 애플리케이션은 로딩되는 시점에서 A클래스가 B클래스를 의존하고 B클래스가 C클래스를 의존한다면, A클래스를 만들 때 B클래스가 필요하니 B부터 생성하고 B를 생성하려면 C가 있어야 하니 C를 가장먼저 생성한다.</p> <p>한마디로 C -&gt; B -&gt; A 순서대로 Bean을 생성한다.</p> <p><strong>여기서 만약 A클래스와 B클래스가 서로 의존한 상태라면??</strong></p> <p>A클래스, B클래스가 Bean을 생성할 때 서로 필요하게 되니까 무한 반복에 빠지게된다.</p> <p>예를 들어 A클래스의 Bean을 만드는 과정에서 B클래스의 Bean을 주입하고, B클래스가 없으니까 Bean을 생성하면서 A클래스를 주입하려고 하는데 없어서 A클래스의 Bean을 생성하게 된다. 이렇게 무한 반복에 빠지게 되는 현상이다.</p> <h4 id="생성자-주입-방식-정리">생성자 주입 방식 정리</h4> <ol> <li>클래스가 서로 의존성 주입을 통해 순환참조하고 있을 때 발생하는 문제</li> <li>스프링 애플리케이션 로딩시점에서 예외가 발생</li> </ol> <h2 id="해결방법">해결방법</h2> <p>순환참조문제가 발생할 수 있는 구조자체를 만들지 않는 것이 가장 좋다.!!</p> <p>처음부터 순환의 고리를 끊어내야한다. 하지만 당장 순환을 끊을 수 없는 경우에는 @Lazy 어노테이션을 통해 임의로 해결할 수 있다.</p> <div class="post-tags"> <nav class="nav-post-tags-list"> <ul class="tags"> <li><a href="/category/spring-boot/">Spring boot</a></li> <li><a href="/category/spring-framework/">Spring Framework</a></li> <li><a href="/tag/tip/">Tip</a></li> <li><a href="/tag/circular-dependencies/">Circular dependencies</a></li> </ul> </nav> </div> </main> <footer> <hr class="footer-hr"> <div class="ui-flex"> <div class='wrapper-footer'> © 2022 HeoYou You don't know this? | Made with <a href="https://github.com/slashformotion/jekyll-archie">Jekyll-Archie</a> and <a href="https://jekyllrb.com">Jekyll</a> </div> </div> </footer> </div> </body> </html>
